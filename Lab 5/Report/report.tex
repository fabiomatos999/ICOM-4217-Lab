\documentclass[journal]{IEEEtran}
\hyphenation{op-tical net-works semi-conduc-tor}
\usepackage{siunitx}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{hyperref}
\usepackage{float}
\usepackage{tabularx}
\usepackage{unicode}
\usepackage[table]{xcolor}
\newcommand\createfigure[2]{
  \begin{figure}[H]
    \centering \includegraphics[width=0.4\textwidth]{#1}
    \caption{#2}
  \end{figure}}
\begin{document}
\title{Experiment 5 Tasks\\ Lab Report} \author{Fabio J. Matos
  Nieves (802-18-6134), Enrique Chompre Gonzalez (802-18-6106), \\Guillermo Col√≥n Bernardi (802-16-1272)}
\maketitle
\begin{abstract}
  The purpose of this document is to detail an implementation of pulse width modulation (PWM) using an MSP430 microcontroller and exploring the advantages and disadvantages of using low power modes on the MSP430.
\end{abstract}
\begin{IEEEkeywords}
  MCU, LDC, Display, Pins, LED, Keypad, PWM, LPM, DC
\end{IEEEkeywords}
\IEEEpeerreviewmaketitle
\section{Introduction}
\IEEEPARstart{T}{he} first task for this laboratory assignment consists of measuring and comparing the current consumption between the a program based on polling versus a program based on interrupts and low power modes (LPM). Polling is the act of processor constantly checking if a resource has changed in any way. For example, checking if a button has been pressed or an I/O pin has changed from a 1 to a 0. LPM based programs setup the MCU in the bootstrapping sequence and then send the MCU to a low power state in order to minimize power consumption and uses interrupts to wake up the CPU to process data when necessary and then send it back to sleep. LPM modes may disable a verity of features in order to reduce power consumption, like turning of the CPU or disabling various clock signals. For the second task of this assignment was the generation of PWM signals at various frequencies. PWM (pulse width modulation) is a type of binary signal that can be generated at various frequencies and duty cycles (DC). Duty cycle is the amount of time that a PWM signal is in a high state, so a PWM signal with a 40\% duty cycle would be 40\% on and 60\% off. The third task consisted of using a 1\si{kHz} PWM signal and by modifying the DC on the three individual LEDs of an RGB LED, various colors can be generated by changing the brightness of either the red, green or blue LEDs. The complementary task of this assignment was using a 1\si{kHz} PWM signal on a white LED, a 3x4 keypad and an LCD display to controll the brightness of the LED by using the keypad and displaying the current brightness of the LED as a percentage.\\
\section{Materials and Methods}
Materials:
\begin{itemize}
  \item 1 Development Board
  \item 1 IDE application
  \item 2 line, 16 character LCD display.
  \item 1 5mm Red LED
  \item 1 5mm RGB LED
  \item 1 1/4W 220\si{\ohm} Carbon fill resistor.
  \item 3 1/4W 510\si{\ohm} Carbon fill resistor.
  \item 4 1/4W 4.7K\si{\ohm} Carbon fill resistor.
  \item Momentary Switch (Pushbutton)
  \item 1 3x4 Keypad
  \item 1 Multimeter
\end{itemize}
Methods:
Firstly, the development board was setup using the program and hardware configuration from Experiment \#2 with polling and supplied power to the development board using 3.3\si{\volt} on the VCC pin on RF3 and a multimeter in series with the ground of power supply. This resulted in $Average I_{CC}1 = 0.597\si{\mA}$ and while scrolling the current peaked up to $0.8\si{\mA}$. Afterwards, the code from experiment 2 was edited to use interrupts and low power mode 4 (LPM4) which resulted $Average I_{CC}2 = 0.412\si{\mA}$. Interestingly, the current while scrolling was higher than the version of the code using polling (upwards up 0.9\si{mA}) and this is due to the fact that the CPU within the MCU was turned off by using LPM4 and has to restart when it receives an interrupt. In section 5.2.2 of the experiment PWM signal generation was setup on P1.2 at 1\si{\kHz} and then we completed tables 5.2 and 5.2.
\begin{table}[H]
  \begin{center}
  \begin{tabularx}{0.4\textwidth}{|X|X|X|X|}
    \hline
    \rowcolor{gray}
    Frequency & Period & Period Register Value & 50\% Duty cycle (DC) register value\\
    \hline
    500\si{\Hz} & 2000\si{us} & 2000 & 1000\\
    \hline
    1\si{\kHz} & 1000\si{us} & 1000 & 500\\
    \hline
    2\si{\kHz} & 500\si{us} 500 & 500 & 250\\
    \hline
    4\si{\kHz} & 250\si{us} & 250 & 125\\
    \hline
    8\si{\kHz} & 125\si{us} & 125 & 62 \\
    \hline
  \end{tabularx}
  \caption{Timer MCU Values}
  \end{center}
\end{table}
\begin{table}[H]
  \begin{center}
  \begin{tabularx}{0.4\textwidth}{|X|X|X|X|}
    \hline
    \rowcolor{gray}
    \hline
    500\si{\Hz} & Measured T & Measured DC & \% Error DC \\
    \hline
    1\si{\kHz} & 1.002\si{kHz} & 49.5\% & 1\% \\
    \hline
    2\si{\kHz} & 503\si{Hz} & 49.7\% & 0.6\%\\
    \hline
    4\si{\kHz}  & 4.0\si{kHz} & 48\% & 4\%\\
    \hline
    8\si{\kHz} & 8\si{kHz} & 44\% & 12\%\\
    \hline
  \end{tabularx}
  \caption{Timer MCU Values}
  \end{center}
\end{table}
In section 5.2.3 an RGB LED was controlled using 3 timers by controlling the duty cycle of each timer independently. To do this a struct of 8 bit RGB values was created for the red, green and blue LEDs and based on the value will set the duty cycle for the red, green or blue LED between 0\% and 100\%. Afterwards a lookup table was created for 8 different RGB values and cycle through the lookup table using a pushbutton.
\begin{table}[H]
  \begin{center}
  \begin{tabularx}{0.4\textwidth}{|X|X|X|X|}
    \hline
    \rowcolor{gray}
     & R & G & B \\
    \hline
    \textbf{1} & 0 & 0 & 255\\
    \hline
    \textbf{2} & 0 & 255 & 0\\
    \hline
    \textbf{3} & 255 & 0 & 0\\
    \hline
    \textbf{4} & 255 & 30 & 217\\
    \hline
    \textbf{5} & 30 & 222 & 252\\
    \hline
    \textbf{6} & 240 & 200 & 40\\
    \hline
    \textbf{7} & 255 & 123 & 33\\
    \hline
    \textbf{8} & 255 & 255 & 255\\
    \hline
  \end{tabularx}
  \caption{RGB Color Values}
  \end{center}
\end{table}
In section 5.3.1 a header file was for functions related keypad created in Experiment 3 and used the header file for the LCD functions created in Experiment 2 to modulate a white LED from 0\% brightness to 100\% brightness and display the brightness level as a percentage on the LCD display.
\section{Results}
\createfigure{./Figures/5.2.1-Polling.jpg}{Section 5.2.1 Polling Hardware Configuration and Result}
\createfigure{./Figures/5.2.1-Interrupt.jpg}{Section 5.2.1 Interrupt Hardware Configuration and Result}
\createfigure{./Figures/5.2.2-500Hz.jpg}{Section 5.2.2 500\si{Hz} 50\%DC PWM Generation}
\createfigure{./Figures/5.2.2-1kHz.jpg}{Section 5.2.2 1\si{kHz} 50\%DC PWM Generation}
\createfigure{./Figures/5.2.2-2kHz.jpg}{Section 5.2.2 2\si{kHz} 50\%DC PWM Generation}
\createfigure{./Figures/5.2.2-4kHz.jpg}{Section 5.2.2 4\si{kHz} 50\%DC PWM Generation}
\createfigure{./Figures/5.2.2-8kHz.jpg}{Section 5.2.2 8\si{kHz} 50\%DC PWM Generation}
\createfigure{./Figures/5.2.3-Setup.jpg}{Section 5.2.3 Hardware Configuration}
\createfigure{./Figures/5.3.1-Setup.jpg}{Section 5.3.1 Hardware Configuration}
\nocite{rojasEmbeddedSystemsDesign2016}
\nocite{LCDControllerDatasheets}
\bibliographystyle{IEEEtran}
\bibliography{./references.bib}
\end{document}
